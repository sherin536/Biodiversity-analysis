library(vegan)#???ذ?
spe<- read.csv("spe_s.csv",sep=",",header = T,row.names = 1,check.names = F)# Ⱥ??????????,????????????????????Ϊ??ʹ???????ݸ?ʽΪ??ֵ?ͣ?????colClasses??7Ϊ???????ࡣ
spe<-t(decostand(spe,method = "hellinger"))
env=read.csv("senv.csv",header=TRUE,row.names=1,sep=",") #???????ݣ??????���?????????????ӡ??鹹???ݽ??????̳?
env=log10(env+1)
#varpart(Y, X, ..., data, chisquare = FALSE, transfo, scale = FALSE,add = FALSE, sqrt.dist = FALSE, permutations)
#transfo??ʾ?????ݽ???ת????helΪhellingerת???????⡰????ЧӦ??
mvpa1 <- varpart(spe, env[,c(2,3)], env[,c(1,4,5)])
mvpa1
plot(mvpa1, bg=6:5,lwd=2)
vpa2 <- varpart(spe, env[,c(2,3)],
                mite.env[c('Substrate', 'Shrub','Topo')], add = TRUE)#ֻ??????????1?е?��??
plot(vpa2, digits = 2, Xnames = c('Subs+Wat',
                                  'Subs+Shrub+Topo'), bg = c('blue', 'red'))
anova.cca(rda(spe, env[,c(1)]), permutations = 999)#??֤????????1??'T','pH'??ȫ?????????????Լ???
anova.cca(rda(spe, env[,c(1,6)],env[,c(2,3,4,5,7,8,9)]), permutations = 999)#??֤????????1??'T','pH'?Ե??��??????Լ???
# ƫ????????(Partial canonical ordination,ƫRDA)  ????partial RDA????999?ε??û????飬?????ó?ģ?͵???????
anova.cca(rda(spe, env[,c(1,4,5)]), permutations = 999)
anova.cca(rda(spe, env[,c(2,3,4,5,7,8,9)]), permutations = 999)#??֤????????1??'SubsDens','WatrCont'?Ե??��??????Լ???
# ƫ????????(Partial canonical ordination,ƫRDA)  ????partial RDA????999?ε??û????飬?????ó?ģ?͵???????
library(rdacca.hp)
permu.hp (spe,env, type="RDA", permutations=999) 

env <- env[,c(1:4,6)]
spe.rda.all <- rda(spe ~ ., data=env)
step.forward <- ordistep(rda(spe ~ 1, data=env), scope = formula(spe.rda.all ), 
                         direction="forward", pstep = 1000)
